// @license Copyright (C) 2015 Erik Ringsmuth - MIT license
!function(t,e){function a(t,a,r){var i=e.createEvent("CustomEvent");return i.initCustomEvent(t,!1,!0,a),r.dispatchEvent(i)}function r(e){var r=g.parseUrl(t.location.href,e.getAttribute("mode"));if(r.hash!==b.hash&&r.path===b.path&&r.search===b.search&&r.isHashPath===b.isHashPath)return d(r.hash),void 0;b=r;var n={path:r.path};if(a("state-change",n,e)){for(var s=e.firstElementChild;s;){if("APP-ROUTE"===s.tagName&&g.testRoute(s.getAttribute("path"),r.path,e.getAttribute("trailingSlash"),s.hasAttribute("regex")))return i(e,s,r),void 0;s=s.nextSibling}a("not-found",n,e)}}function i(t,e,r){if(e.hasAttribute("redirect"))return t.go(e.getAttribute("redirect"),{replace:!0}),void 0;var i={path:r.path,route:e,oldRoute:t.activeRoute};a("activate-route-start",i,t)&&a("activate-route-start",i,e)&&(t.previousRoute&&t.previousRoute.transitionAnimationInProgress&&l(t.previousRoute),t.activeRoute&&t.activeRoute.removeAttribute("active"),t.previousRoute=t.activeRoute,t.activeRoute=e,t.activeRoute.setAttribute("active","active"),e.hasAttribute("import")?n(t,e.getAttribute("import"),e,r,i):e.hasAttribute("element")?o(t,e.getAttribute("element"),e,r,i):e.firstElementChild&&"TEMPLATE"===e.firstElementChild.tagName&&h(t,e.firstElementChild,e,r,i))}function n(t,a,r,i,n){function o(){s(t,h,a,r,i,n)}var h;f.hasOwnProperty(a)?(h=e.querySelector('link[href="'+a+'"]'),h.import?o():h.addEventListener("load",o)):(f[a]=!0,h=e.createElement("link"),h.setAttribute("rel","import"),h.setAttribute("href",a),h.addEventListener("load",o),e.head.appendChild(h))}function s(t,e,a,r,i,n){r.hasAttribute("active")&&(r.hasAttribute("template")?h(t,e.import.querySelector("template"),r,i,n):o(t,r.getAttribute("element")||a.split("/").slice(-1)[0].replace(".html",""),r,i,n))}function o(t,a,r,i,n){var s=e.createElement(a),o=u(t,r,i,n);for(var h in o)o.hasOwnProperty(h)&&(s[h]=o[h]);c(t,s,i,n)}function h(t,a,r,i,n){var s;if("createInstance"in a){var o=u(t,r,i,n);s=a.createInstance(o)}else s=e.importNode(a.content,!0);c(t,s,i,n)}function u(t,e,r,i){var n=g.routeArguments(e.getAttribute("path"),r.path,r.search,e.hasAttribute("regex"),"auto"===t.getAttribute("typecast"));return(e.hasAttribute("bindRouter")||t.hasAttribute("bindRouter"))&&(n.router=t),i.model=n,a("before-data-binding",i,t),a("before-data-binding",i,i.route),i.model}function c(t,e,r,i){t.hasAttribute("core-animated-pages")&&i.route!==i.oldRoute||p(t.previousRoute),t.activeRoute.appendChild(e),t.hasAttribute("core-animated-pages")&&(t.coreAnimatedPages.selected=t.activeRoute.getAttribute("path"),t.previousRoute&&(t.previousRoute.transitionAnimationInProgress=!0)),r.hash&&!t.hasAttribute("core-animated-pages")&&d(r.hash),a("activate-route-end",i,t),a("activate-route-end",i,i.route)}function l(t){t&&(t.transitionAnimationInProgress=!1,p(t))}function p(t){if(t)for(var e=t.firstChild;e;){var a=e;e=e.nextSibling,"TEMPLATE"!==a.tagName&&t.removeChild(a)}}function d(t){t&&setTimeout(function(){var a=e.querySelector("html /deep/ "+t)||e.querySelector('html /deep/ [name="'+t.substring(1)+'"]');a&&a.scrollIntoView&&a.scrollIntoView(!0)},0)}function v(t,e,a,r){var i=t[e],n=a[r];if("undefined"==typeof i||"undefined"==typeof n)return i===n;if(i===n||"*"===i||":"===i.charAt(0))return v(t,e-1,a,r-1);if("**"===i)for(var s=r;s>=0;s--)if(v(t,e-1,a,s))return!0;return!1}var g={},f={},m="ActiveXObject"in t,b={},A=Object.create(HTMLElement.prototype);A.util=g,e.registerElement("app-route",{prototype:Object.create(HTMLElement.prototype)}),A.attachedCallback=function(){"manual"!==this.getAttribute("init")&&this.init()},A.init=function(){var a=this;a.isInitialized||(a.isInitialized=!0,a.hasAttribute("trailingSlash")||a.setAttribute("trailingSlash","strict"),a.hasAttribute("mode")||a.setAttribute("mode","auto"),a.hasAttribute("typecast")||a.setAttribute("typecast","auto"),a.hasAttribute("core-animated-pages")&&(a.createShadowRoot(),a.coreAnimatedPages=e.createElement("core-animated-pages"),a.coreAnimatedPages.appendChild(e.createElement("content")),a.coreAnimatedPages.style.position="static",a.coreAnimatedPages.setAttribute("valueattr","path"),a.coreAnimatedPages.setAttribute("transitions",a.getAttribute("transitions")),a.shadowRoot.appendChild(a.coreAnimatedPages),a.coreAnimatedPages.addEventListener("core-animated-pages-transition-end",function(){l(a.previousRoute)})),a.stateChangeHandler=r.bind(null,a),t.addEventListener("popstate",a.stateChangeHandler,!1),m&&t.addEventListener("hashchange",a.stateChangeHandler,!1),r(a))},A.detachedCallback=function(){t.removeEventListener("popstate",this.stateChangeHandler,!1),m&&t.removeEventListener("hashchange",this.stateChangeHandler,!1)},A.go=function(a,r){"pushstate"!==this.getAttribute("mode")&&(a="#"+a),r&&r.replace===!0?t.history.replaceState(null,null,a):t.history.pushState(null,null,a);try{var i=new PopStateEvent("popstate",{bubbles:!1,cancelable:!1,state:{}});"dispatchEvent_"in t?t.dispatchEvent_(i):t.dispatchEvent(i)}catch(n){var s=e.createEvent("CustomEvent");s.initCustomEvent("popstate",!1,!1,{state:{}}),t.dispatchEvent(s)}},g.parseUrl=function(t,a){var r={isHashPath:"hash"===a};if("function"==typeof URL){var i=new URL(t);r.path=i.pathname,r.hash=i.hash,r.search=i.search}else{var n=e.createElement("a");n.href=t,r.path=n.pathname,"/"!==r.path.charAt(0)&&(r.path="/"+r.path),r.hash=n.hash,r.search=n.search}if("pushstate"!==a&&("#/"===r.hash.substring(0,2)?(r.isHashPath=!0,r.path=r.hash.substring(1)):"#!/"===r.hash.substring(0,3)?(r.isHashPath=!0,r.path=r.hash.substring(2)):r.isHashPath&&(r.path=0===r.hash.length?"/":r.hash.substring(1)),r.isHashPath)){r.hash="";var s=r.path.indexOf("#");-1!==s&&(r.hash=r.path.substring(s),r.path=r.path.substring(0,s));var o=r.path.indexOf("?");-1!==o&&(r.search=r.path.substring(o),r.path=r.path.substring(0,o))}return r},g.testRoute=function(t,e,a,r){if("ignore"===a&&("/"===e.slice(-1)&&(e=e.slice(0,-1)),"/"!==t.slice(-1)||r||(t=t.slice(0,-1))),r)return g.testRegExString(t,e);if(t===e||"*"===t)return!0;"/"!==t.charAt(0)&&(t="/**/"+t);var i=e.split("/"),n=t.split("/");return v(n,n.length-1,i,i.length-1)},g.routeArguments=function(t,e,a,r,i){var n={};if(!r)for(var s=e.split("/"),o=t.split("/"),h=o.length-1,u=s.length-1;u>=0&&h>=0;){{var c=o[h];s[u]}":"===c.charAt(0)&&(n[c.substring(1)]=s[u]),h--,u--}var l=a.substring(1).split("&");1===l.length&&""===l[0]&&(l=[]);for(var p=0;p<l.length;p++){var d=l[p],v=d.split("=");n[v[0]]=v.splice(1,v.length-1).join("=")}if(i)for(var f in n)n[f]=g.typecast(n[f]);return n},g.typecast=function(t){return"true"===t?!0:"false"===t?!1:isNaN(t)||""===t||"0"===t.charAt(0)?decodeURIComponent(t):+t},g.testRegExString=function(t,e){if("/"!==t.charAt(0))return!1;t=t.slice(1);var a="";if("/"===t.slice(-1))t=t.slice(0,-1);else{if("/i"!==t.slice(-2))return!1;t=t.slice(0,-2),a="i"}return new RegExp(t,a).test(e)},e.registerElement("app-router",{prototype:A})}(window,document);