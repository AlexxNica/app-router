<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../layouts/scaffold-layout.html">
<link rel="import" href="../elements/code-block.html">
<link rel="import" href="../elements/code-snippet.html">

<polymer-element name="notes-page" noscript>
  <template>
    <scaffold-layout selected="notes">
      <div class="title">Notes</div>

      <h2 id="breaking-changes">Breaking Changes <a href="../#/notes#breaking-changes">#</a></h2>

      <p>Check the <a href="https://github.com/erikringsmuth/app-router/blob/master/changelog.md">change log</a> for breaking changes in major versions.</p>

      <h2 id="html-imports-and-relative-paths" class="top-spacing">HTML Imports & Relative Paths <a href="../#/notes#html-imports-and-relative-paths">#</a></h2>

      <p>Relative paths work differently when inside of an imported document. The current URL is <code-snippet>/app-router/#/notes</code-snippet>, the current directory is <code-snippet>/app-router/</code-snippet>, and the current imported document is <code-snippet>/app-router/pages/notes-page.html</code-snippet>. This means all relative paths will be relative to <code-snippet>/app-router/pages/</code-snippet> or <code-snippet>/app-router/pages/notes-page.html</code-snippet>, not <code-snippet>/app-router/</code-snippet>.</p>

      <h3 id="relative-paths" class="top-spacing">Relative Paths <a href="../#/notes#relative-paths">#</a></h3>
      <ul>
        <li><a href="test"><code-snippet>href="test"</code-snippet></a> - links to <code-snippet>/app-router/pages/test</code-snippet></li>
        <li><a href="#test"><code-snippet>href="#test"</code-snippet></a> - links to <code-snippet>/app-router/pages/notes-page.html#test</code-snippet></li>
      </ul>

      <h3 id="absolute-paths" class="top-spacing">Absolute Paths <a href="../#/notes#absolute-paths">#</a></h3>
      <ul>
        <li><a href="/test"><code-snippet>href="/test"</code-snippet></a> - links to <code-snippet>/test</code-snippet></li>
        <li><a href="/#/test"><code-snippet>href="/#/test"</code-snippet></a> - links to <code-snippet>/#/test</code-snippet></li>
      </ul>

      <p>I'm not sure if <code-snippet>href="#test"</code-snippet> linking to <code-snippet>/app-router/pages/notes-page.html#test</code-snippet> is intentional or a bug. Using an absolute hash path works <code-snippet>href="/#/test"</code-snippet>.</p>

      <h3 id="relative-path-reasoning" class="top-spacing">Relative Path Reasoning <a href="../#/notes#relative-path-reasoning">#</a></h3>
      <p>According to the <a href="https://github.com/polymer/HTMLImports#polyfill-notes">platform polyfill notes</a>, HTML Imports treat relative paths in a special way. This allows a custom element to load it's dependencies relative to it's current location. For example, if</p>
      <code-block>/bower_components/app-router/app-router.html</code-block>

      <p>depends on</p>
      <code-block>/bower_components/app-router/app-router.js</code-block>

      <p>it can load it with</p>
      <code-block>&lt;script src="app-router.js"&gt;&lt;/script&gt;</code-block>

      <p>It doesn't matter where you put the <code-snippet>app-router</code-snippet> folder. It doesn't need to be in <code-snippet>/bower-components/</code-snippet> since it's dependencies are loaded relative to the <code-snippet>app-router</code-snippet> directory and not relative to the current URL's directory.</p>

      <p>The odd thing is that this also applies to <code-snippet>&lt;a&gt;</code-snippet> tags, not just <code-snippet>&lt;link&gt;</code-snippet> and <code-snippet>&lt;script&gt;</code-snippet> tags. This means <code-snippet>&lt;a href="#test"&gt;&lt;/a&gt;</code-snippet> is relative to the imported document, not the current URL. On this page <code-snippet>&lt;a href="#test"&gt;&lt;/a&gt;</code-snippet> will point to <code-snippet>/app-router/pages/notes-page.html#test</code-snippet>. This is a custom element, not a displayable page.</p>

      <p>I'm not sure if this is a bug or the intended way HTML Imports are supposed to handle this. If anyone knows, let me know!</p>

      <h2 id="pushstate" class="top-spacing">pushState <a href="../#/notes#pushstate">#</a></h2>

      <p>You can use the <a href="https://github.com/erikringsmuth/pushstate-anchor">pushstate-anchor</a> or <a href="https://github.com/erikringsmuth/html5-history-anchor">html5-history-anchor</a> to extend <code-snippet>&lt;a&gt;</code-snippet> tags with the HTML5 history API.</p>

<code-block>&lt;a is="pushstate-anchor" href="/home"&gt;Home&lt;/a&gt;</code-block>

      <p>When you use HTML5 <code-snippet>pushState()</code-snippet> you have to manually fire a <code-snippet>popstate</code-snippet> event. The <code-snippet>pushState()</code-snippet> method was not meant to change the page, it was only meant to push state into history. This is an "undo" feature for single page applications. To use <code-snippet>pushState()</code-snippet> to navigate to another route you need to call it like this.</p>

<code-block>// push a new URL into the history stack
history.pushState(stateObj, title, '/home');
// dispatch a popstate event
window.dispatchEvent(new PopStateEvent('popstate', {
  bubbles: false,
  cancelable: false,
  state: history.state
}));</code-block>

      <p>The <a href="https://github.com/erikringsmuth/pushstate-anchor">pushstate-anchor</a> takes care of this for you by calling <code-snippet>pushState()</code-snippet> and dispatching a <code-snippet>popstate</code-snippet> event.</p>

      <h2 id="cordova" class="top-spacing">Cordova compatibility <a href="../#/notes#cordova">#</a></h2>

      <p>When using app-router with <a href="http://cordova.apache.org/">Cordova</a>, there are two caveats to be aware of: relative path URLs and the default page URL.</p>

      <h3 id="cordova-relative-paths" class="top-spacing">Cordova relative paths <a href="../#/notes#cordova-relative-paths">#</a></h3>

      <p>When Cordova packages your web application for distribution as a mobile app, it copies your website onto local storage and loads it using the <code-snippet>file://</code-snippet> protocol. As a result, your pages will fail to load if you use absolute paths like this.</p>

<code-block>&lt;app-router&gt;
  &lt;app-route path="/" import="/pages/home-page.html"&gt;&lt;/app-route&gt;
  &lt;app-route path="*" import="/pages/not-found.html"&gt;&lt;/app-route&gt;
&lt;/app-router&gt;</code-block>

      <p>Instead, use relative paths for your page URLs like this.</p>

<code-block>&lt;app-router&gt;
  &lt;app-route path="/" import="pages/home-page.html"&gt;&lt;/app-route&gt;
  &lt;app-route path="*" import="pages/not-found.html"&gt;&lt;/app-route&gt;
&lt;/app-router&gt;</code-block>

      <h3 id="cordova-default-url" class="top-spacing">Cordova default URL <a href="../#/notes#cordova-default-url">#</a></h3>

      <p>Cordova loads the default page from <code-snippet>file://.../www/index.html</code-snippet> where the path varies across mobile platforms. To make your application's default homepage load as cross platform as possible, try using a routing table like this.</p>

<code-block>&lt;app-router&gt;
  &lt;app-route path="/" import="pages/home-page.html"&gt;&lt;/app-route&gt;
  &lt;app-route path="/.*/www/index.html/" regex import="pages/home-page.html"&gt;&lt;/app-route&gt;
  &lt;app-route path="*" import="pages/not-found.html"&gt;&lt;/app-route&gt;
&lt;/app-router&gt;</code-block>

    </scaffold-layout>
  </template>
</polymer-element>
