<script>(function(window,document){document.registerElement("app-route",{prototype:Object.create(HTMLElement.prototype)});document.registerElement("active-route",{prototype:Object.create(HTMLElement.prototype)});var router=Object.create(HTMLElement.prototype);var importedURIs={};router.attachedCallback=function(){this.previousState="";this.activeRoute=document.createElement("app-route");this.stateChangeHandler=this.changeActiveRoute.bind(this);window.addEventListener("popstate",this.stateChangeHandler,false);window.addEventListener("hashchange",this.stateChangeHandler,false);if(this.hasAttribute("shadow")){this.activeRouteContent=this.createShadowRoot()}else{this.activeRouteContent=document.createElement("active-route");this.appendChild(this.activeRouteContent)}this.changeActiveRoute()};router.detachedCallback=function(){window.removeEventListener("popstate",this.stateChangeHandler,false);window.removeEventListener("hashchange",this.stateChangeHandler,false)};router.changeActiveRoute=function(){if(this.previousState!==window.location.href){this.previousState=window.location.href;var urlPath=this.urlPath(window.location.href);var routes=this.querySelectorAll("app-route");for(var i=0;i<routes.length;i++){if(this.testRoute(routes[i].getAttribute("path"),urlPath)){this.activateRoute(routes[i],urlPath);break}}}};router.activateRoute=function(route,urlPath){this.activeRoute.removeAttribute("active");route.setAttribute("active","active");this.activeRoute=route;var importUri=route.getAttribute("import");var routePath=route.getAttribute("path");var elementName=route.getAttribute("element");var isTemplate=route.hasAttribute("template");var isElement=!isTemplate;if(isElement&&importUri){this.importAndActivateCustomElement(importUri,elementName,routePath,urlPath)}else if(isElement&&!importUri&&elementName){this.activateCustomElement(elementName,routePath,urlPath)}else if(isTemplate&&importUri){this.importAndActivateTemplate(importUri,route)}else if(isTemplate&&!importUri){this.activateTemplate(route)}};router.importAndActivateCustomElement=function(importUri,elementName,routePath,urlPath){if(!importedURIs.hasOwnProperty(importUri)){importedURIs[importUri]=true;var elementLink=document.createElement("link");elementLink.setAttribute("rel","import");elementLink.setAttribute("href",importUri);document.head.appendChild(elementLink)}this.activateCustomElement(elementName||importUri.split("/").slice(-1)[0].replace(".html",""),routePath,urlPath)};router.activateCustomElement=function(elementName,routePath,urlPath){var resourceEl=document.createElement(elementName);var routeArgs=this.routeArguments(routePath,urlPath,window.location.href);for(var arg in routeArgs){if(routeArgs.hasOwnProperty(arg)){resourceEl[arg]=routeArgs[arg]}}this.replaceActiveElement(resourceEl)};router.importAndActivateTemplate=function(importUri,route){if(importedURIs.hasOwnProperty(importUri)){var previousLink=document.querySelector('link[href="'+importUri+'"]');if(previousLink.import){this.replaceActiveElement(document.importNode(previousLink.import.querySelector("template").content,true))}else{previousLink.onload=function(){if(route.hasAttribute("active")){this.replaceActiveElement(document.importNode(previousLink.import.querySelector("template").content,true))}}.bind(this)}}else{importedURIs[importUri]=true;var templateLink=document.createElement("link");templateLink.setAttribute("rel","import");templateLink.setAttribute("href",importUri);templateLink.onload=function(){if(route.hasAttribute("active")){this.replaceActiveElement(document.importNode(templateLink.import.querySelector("template").content,true))}}.bind(this);document.head.appendChild(templateLink)}};router.activateTemplate=function(route){var clone=document.importNode(route.querySelector("template").content,true);this.replaceActiveElement(clone)};router.replaceActiveElement=function(newElement){while(this.activeRouteContent.firstChild){this.activeRouteContent.removeChild(this.activeRouteContent.firstChild)}this.activeRouteContent.appendChild(newElement)};router.urlPath=function(url){var splitUrl=url.split("/");var relativeUri="/"+splitUrl.splice(3,splitUrl.length-3).join("/");var path=relativeUri.split(/[\?#]/)[0];var hashIndex=relativeUri.indexOf("#");if(hashIndex!==-1){var hash=relativeUri.substring(hashIndex).split("?")[0];if(hash.substring(0,2)==="#/"){path=hash.substring(1)}else if(hash.substring(0,3)==="#!/"){path=hash.substring(2)}}return path};router.testRoute=function(routePath,urlPath){if(this.getAttribute("trailingSlash")==="ignore"){if(urlPath.slice(-1)==="/"){urlPath=urlPath.slice(0,-1)}if(routePath.slice(-1)==="/"){routePath=routePath.slice(0,-1)}}if(routePath===urlPath||routePath==="*"){return true}if(routePath.indexOf("*")===-1&&routePath.indexOf(":")===-1){return false}var urlPathSegments=urlPath.split("/");var routePathSegments=routePath.split("/");if(urlPathSegments.length!==routePathSegments.length){return false}for(var i=0;i<routePathSegments.length;i++){var routeSegment=routePathSegments[i];if(routeSegment!==urlPathSegments[i]&&routeSegment!=="*"&&routeSegment.charAt(0)!==":"){return false}}return true};router.routeArguments=function routeArguments(routePath,urlPath,url){var args={};var urlPathSegments=urlPath.split("/");var routePathSegments=routePath.split("/");for(var index=0;index<routePathSegments.length;index++){var routeSegment=routePathSegments[index];if(routeSegment.charAt(0)===":"){args[routeSegment.substring(1)]=urlPathSegments[index]}}var searchIndex=url.indexOf("?");var search="";if(searchIndex!==-1){search=url.substring(searchIndex);var hashIndex=search.indexOf("#");if(hashIndex!==-1){search=search.substring(0,hashIndex)}}var hashPathIndex=url.indexOf("#/");var hashBangPathIndex=url.indexOf("#!/");if(hashPathIndex!==-1||hashBangPathIndex!==-1){var hash="";if(hashPathIndex!==-1){hash=url.substring(hashPathIndex)}else{hash=url.substring(hashBangPathIndex)}searchIndex=hash.indexOf("?");if(searchIndex!==-1){search=hash.substring(searchIndex)}}var queryParameters=search.substring(1).split("&");if(queryParameters.length===1&&queryParameters[0]===""){queryParameters=[]}for(var i=0;i<queryParameters.length;i++){var queryParameter=queryParameters[i];var queryParameterParts=queryParameter.split("=");args[queryParameterParts[0]]=queryParameterParts.splice(1,queryParameterParts.length-1).join("=")}for(var arg in args){var value=args[arg];if(value==="true"){args[arg]=true}else if(value==="false"){args[arg]=false}else if(!isNaN(value)&&value!==""){args[arg]=+value}else{args[arg]=decodeURIComponent(value)}}return args};document.registerElement("app-router",{prototype:router})})(window,document);</script>