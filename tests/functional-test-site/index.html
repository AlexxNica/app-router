<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>app-router</title>
    <script src="/bower_components/webcomponentsjs/webcomponents.js" debug></script>
    <link rel="import" href="/bower_components/polymer/polymer.html">
    <link rel="import" href="pages/bundled-elements.html">
    <link rel="import" href="/src/app-router.html">
  </head>
  <body>
    <style>
      p {
        margin-top: 50px;
      }
    </style>

    <p>Test the different <code>app-route</code> types by navigating through these links.</p>
    <ul>
      <li><a href="#/custom-element">/custom-element</a></li>
      <li><a href="#/preloaded-bundled-custom-element">/preloaded-bundled-custom-element</a></li>
      <li><a href="#/imported-bundled-custom-element">/imported-bundled-custom-element</a></li>
      <li><a href="#/template">/template</a></li>
      <li><a href="#/inline-template">/inline-template</a></li>
      <li><a href="#/word/123">/regular-expression</a></li>
      <li><a href="#/template-binding/1234/route%20args!">/template-binding/1234/route%20args!</a></li>
      <li><a href="#/custom-element-binding/1234/route%20args!">/custom-element-binding/1234/route%20args!</a></li>
      <li><a href="#/redirect">/redirect</a></li>
      <li><a href="#/canceled-event">/canceled-event</a></li>
    </ul>

    <!-- defaults -->
    <p>All of these links should match different variations of elements, templates, lazy-loading, and inline.</p>
    <app-router id="default-router">
      <app-route path="/custom-element" import="pages/custom-element-page.html"></app-route>
      <app-route path="/preloaded-bundled-custom-element" element="preloaded-custom-element-page"></app-route>
      <app-route path="/imported-bundled-custom-element" import="pages/imported-bundled-elements.html" element="imported-custom-element-page"></app-route>
      <app-route path="/template" import="pages/template-page.html" template></app-route>
      <app-route path="/inline-template">
        <template>
          <h2>Inline Template Page</h2>
        </template>
      </app-route>
      <app-route path="/^\/\w+\/\d+$/i" regex>
        <template>
          <h2>Regular Expression <code>/^\/\w+\/\d+$/i</code></h2>
        </template>
      </app-route>
      <app-route path="/redirect" redirect="/custom-element"></app-route>
      <app-route path="*" import="pages/not-found-page.html"></app-route>
    </app-router>

    <!-- trailingSlash="ignore" -->
    <p>Should ignore trailing slashes and match "/custom-element" and "/custom-element/" with the same route.</p>
    <app-router trailingSlash="ignore" id="ignore-trailing-slash">
      <app-route path="/custom-element/" import="pages/custom-element-page.html"></app-route>
      <app-route path="*" import="pages/not-found-page.html"></app-route>
    </app-router>

    <!-- init="manual" -->
    <p>Should manually be initialized. Only matches "/custom-element".</p>
    <app-router init="manual" id="manual-init">
      <app-route path="/custom-element" import="pages/custom-element-page.html"></app-route>
      <app-route path="*" import="pages/not-found-page.html"></app-route>
    </app-router>
    <script>
      window.addEventListener('WebComponentsReady', function() {
        document.querySelector('#manual-init').init();
      });
    </script>

    <!-- parent scope -->
    <p>Data binding to templates, app-router in a Polymer element, and parentModel bindings.</p>
    <polymer-element name="parent-binding-page" attributes="second third">
      <template>
        <h2>parent published attribute - {{parentModel.first}}</h2>
        <h2>route arg bound to custom element - {{second}}</h2>
        <h2>route arg bound to custom element - {{third}}</h2>
        <h2>parent property (not published) - {{parentModel.fourth}}</h2>
      </template>
      <script>
        Polymer('parent-binding-page', {
          domReady: function() {
            // dynamic data binding should update the parent's template too
            this.parentModel.first = 'updated 1st arg!';
          }
        });
      </script>
    </polymer-element>
    <polymer-element name="parent-binding-example" attributes="first">
      <template>
        <!-- dynamic data binding should update the parent's template when the child sets parentModel.first -->
        <p>In the parent template, first arg - {{first}}</p>
        <app-router id="default-router">
          <app-route path="/custom-element" import="pages/custom-element-page.html"></app-route>
          <app-route path="/custom-element-binding/:second/:third" element="parent-binding-page"></app-route>
          <app-route path="/template-binding/:second/:third">
            <template>
              <h2>parent published attribute - {{parentModel.first}}</h2>
              <h2>route arg bound to template - {{second}}</h2>
              <h2>route arg bound to template - {{third}}</h2>
              <h2>parent property (not published) - {{parentModel.fourth}}</h2>
            </template>
          </app-route>
          <app-route path="*" import="pages/not-found-page.html"></app-route>
        </app-router>
      </template>
      <script>
        Polymer('parent-binding-example', {
          ready: function() {
            this.fourth = '4th arg!';
          },
          firstChanged: function(oldFirst, newFirst) {
            console.log('parent {{first}} updated: ' + newFirst);
          }
        });
      </script>
    </polymer-element>
    <parent-binding-example first="1st arg!"></parent-binding-example>

    <!-- lifecycle events -->
    <p>Logs lifecycle events. Should <code>preventDefault()</code> when navigating to <code>/canceled-event</code>.</p>
    <app-router init="manual" id="lifecycle-events">
      <app-route path="/custom-element" import="pages/custom-element-page.html"></app-route>
      <app-route path="/canceled-event" id="canceled-event">
        <template>
          <h2>Canceled Event (broken if you can see this)</h2>
        </template>
      </app-route>
      <app-route path="*" import="pages/not-found-page.html"></app-route>
    </app-router>
    <script>
      window.addEventListener('WebComponentsReady', function() {
        var router = document.querySelector('#lifecycle-events');
        var firstRoute = router.querySelector('app-route');
        function routerEventHandler(event) {
          console.log('router: ' + event.type);
          console.log(event.detail);
        }
        function routeEventHandler(event) {
          console.log('route: ' + event.type);
          console.log(event.detail);
        }
        router.addEventListener('state-change', routerEventHandler);
        router.addEventListener('activate-route-start', routerEventHandler);
        router.addEventListener('activate-route-end', routerEventHandler);
        firstRoute.addEventListener('activate-route-start', routeEventHandler);
        firstRoute.addEventListener('activate-route-end', routeEventHandler);

        document.querySelector('#canceled-event').addEventListener('activate-route-start', function(event) {
          event.preventDefault();
        });
        router.init();
      });
    </script>

  </body>
</html>
